<%- include("templates/header") %> <!--Deleted , { currentURL: '/memberManagement' , navLinks: navLinks } -->

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-6">
                <h1>Members</h1>

                <!-- Projects Dropdown -->
                <div class="dropdown mb-3">
                    <button class="btn btn-secondary dropdown-toggle w-100" type="button" id="dropdownMenuButton"
                        data-bs-toggle=" " aria-expanded="false">
                        Select Project
                    </button>
                    <ul class="dropdown-menu position-static d-grid gap-1 p-2 rounded-3 mx-0 shadow w-100"
                        aria-labelledby="dropdownMenuButton">
                        <% projects.forEach(function(project) { %>
                            <li>
                                <a class="dropdown-item rounded-2 <%= project._id.toString() === selectedProjectId ? 'active' : '' %>"
                                    href="/memberManagement?projectId=<%= project._id %>">
                                    <%= project.projectName %>
                                </a>
                            </li>
                            <% }); %>
                    </ul>
                </div>

                <div class="input-group mb-3">
                    <input type="email" class="form-control" placeholder="Member Email" id="member-email-input">
                    <button type="button" class="btn btn-primary" onclick="addMember()">Add
                        Member</button>

                </div>

                <form action="/updateMembersPermissions" method="POST" id="membersForm">
                    <input type="hidden" name="projectId" value="<%= selectedProjectId %>">

                    <!-- Container for Members List -->
                    <div id="membersList">
                        <%- include("templates/memberManagementList", { members: filteredMembers }) %>
                    </div>

                    <div class="d-flex justify-content-center mt-3">
                        <button type="submit" class="btn btn-primary me-5">Save</button>
                        <a href="/workspaceSetting" class="btn btn-secondary ms-5">Back</a>
                    </div>
                </form>


        <script>

/**
 * remove member from a project
 * Generated by ChatGPT 3.5
 * 
 * @author https://chat.openai.com/
 */

            function removeMember(projectId, email) {
                if (!confirm("Are you sure you want to remove this member?")) return;

                fetch(`/removeMember?projectId=${projectId}&memberEmail=${email}`, {
                    method: 'DELETE'
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Member removed successfully');
                            location.reload();  // Reload the page to reflect changes
                        } else {
                            alert('Failed to remove member: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error removing member:', error);
                        alert('Failed to remove member');
                    });
            }
        </script>

        <%- include("templates/footer") %>